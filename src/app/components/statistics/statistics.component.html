<div class="modal-overlay" (click)="onOverlayClick($event)">
  <div class="modal-container">
    <button class="close-btn" (click)="onClose()">
      <span class="material-icons">close</span>
    </button>

    <div class="modal-header">
      <span class="material-icons header-icon">analytics</span>
      <h2>Twoje statystyki</h2>
    </div>

    <div class="modal-content">
      @if (climbedMountains().length === 0) {
        <div class="empty-state">
          <span class="material-icons">hiking</span>
          <p>Nie zdoby≈Çe≈õ jeszcze ≈ºadnego szczytu</p>
          <span class="hint">Zaznacz szczyty, kt√≥re ju≈º zdoby≈Çe≈õ, aby zobaczyƒá statystyki</span>
        </div>
      } @else {
        <!-- Main Stats -->
        <div class="stats-grid">
          <div class="stat-card primary">
            <span class="material-icons">flag</span>
            <div class="stat-info">
              <span class="stat-value">{{ climbedMountains().length }}/{{ allMountains().length }}</span>
              <span class="stat-label">Zdobytych szczyt√≥w</span>
            </div>
          </div>

          <div class="stat-card">
            <span class="material-icons">height</span>
            <div class="stat-info">
              <span class="stat-value">{{ totalHeight() | number }}</span>
              <span class="stat-label">≈ÅƒÖczna wysoko≈õƒá (m)</span>
            </div>
          </div>

          <div class="stat-card">
            <span class="material-icons">show_chart</span>
            <div class="stat-info">
              <span class="stat-value">{{ averageHeight() | number }}</span>
              <span class="stat-label">≈örednia wysoko≈õƒá (m)</span>
            </div>
          </div>
        </div>

        <!-- Highest/Lowest -->
        <div class="extremes-section">
          <h3>Rekordy</h3>
          <div class="extremes-grid">
            @if (highestClimbed()) {
              <div class="extreme-card highest">
                <span class="material-icons">arrow_upward</span>
                <div class="extreme-info">
                  <span class="extreme-name">{{ highestClimbed()!.name }}</span>
                  <span class="extreme-height">{{ highestClimbed()!.height }} m</span>
                  <span class="extreme-label">Najwy≈ºszy zdobyty</span>
                </div>
              </div>
            }
            @if (lowestClimbed()) {
              <div class="extreme-card lowest">
                <span class="material-icons">arrow_downward</span>
                <div class="extreme-info">
                  <span class="extreme-name">{{ lowestClimbed()!.name }}</span>
                  <span class="extreme-height">{{ lowestClimbed()!.height }} m</span>
                  <span class="extreme-label">Najni≈ºszy zdobyty</span>
                </div>
              </div>
            }
          </div>
        </div>

        <!-- Difficulty Progress -->
        <div class="difficulty-section">
          <h3>Postƒôp wg trudno≈õci</h3>
          <div class="difficulty-bars">
            <div class="difficulty-row">
              <span class="difficulty-label easy">≈Åatwe</span>
              <div class="progress-bar-container">
                <div class="progress-bar easy" 
                     [style.width.%]="difficultyStats().easy.total > 0 ? (difficultyStats().easy.climbed / difficultyStats().easy.total * 100) : 0">
                </div>
              </div>
              <span class="difficulty-count">{{ difficultyStats().easy.climbed }}/{{ difficultyStats().easy.total }}</span>
            </div>
            <div class="difficulty-row">
              <span class="difficulty-label medium">≈örednie</span>
              <div class="progress-bar-container">
                <div class="progress-bar medium" 
                     [style.width.%]="difficultyStats().medium.total > 0 ? (difficultyStats().medium.climbed / difficultyStats().medium.total * 100) : 0">
                </div>
              </div>
              <span class="difficulty-count">{{ difficultyStats().medium.climbed }}/{{ difficultyStats().medium.total }}</span>
            </div>
            <div class="difficulty-row">
              <span class="difficulty-label hard">Trudne</span>
              <div class="progress-bar-container">
                <div class="progress-bar hard" 
                     [style.width.%]="difficultyStats().hard.total > 0 ? (difficultyStats().hard.climbed / difficultyStats().hard.total * 100) : 0">
                </div>
              </div>
              <span class="difficulty-count">{{ difficultyStats().hard.climbed }}/{{ difficultyStats().hard.total }}</span>
            </div>
          </div>
        </div>

        <!-- Completed Regions -->
        @if (completedRegions().length > 0) {
          <div class="completed-section">
            <h3>üèÜ Uko≈Ñczone regiony</h3>
            <div class="completed-badges">
              @for (region of completedRegions(); track region.name) {
                <span class="completed-badge">{{ region.name }}</span>
              }
            </div>
          </div>
        }

        <!-- Region Progress -->
        <div class="regions-section">
          <h3>Postƒôp wg region√≥w</h3>
          <div class="regions-list">
            @for (region of regionStats(); track region.name) {
              <div class="region-row">
                <span class="region-name">{{ region.name }}</span>
                <div class="region-progress">
                  <div class="mini-progress-bar">
                    <div class="mini-progress-fill" 
                         [style.width.%]="region.total > 0 ? (region.climbed / region.total * 100) : 0"
                         [class.complete]="region.climbed === region.total">
                    </div>
                  </div>
                  <span class="region-count">{{ region.climbed }}/{{ region.total }}</span>
                </div>
              </div>
            }
          </div>
        </div>
      }
    </div>
  </div>
</div>
